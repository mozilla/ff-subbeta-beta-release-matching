---
title: "Mozilla Data Science Project - 2019"
author: "Mariana de Oliveira Santos Silva"
date: "December 05, 2019"
output: 
  html_document:
    toc: true
    theme: united
    highlight: tango
    df_print: kable
---

# Exploratory Data Analysis (EDA) {.tabset}

This R markdown covers the Exploratory Data Analysis (EDA) on the training dataset of the PRD. 

## Setting-up
```{r message=FALSE, warning=FALSE}
## Loading the needed libraries

library(kableExtra)      # help you build common complex tables and manipulate table styles
library(tidyverse)       # for general data wrangling (includes readr and dplyr)
library(ggplot2)         # to draw statistical plots 
library(plotly)          # to construct interactive 3d plots
library(DataExplorer)    # automated data exploration
library(corrplot)        # to plot nice correlation matrix
library(caret)           # includes several functions to pre-process
library(scales)          # to determining breaks and labels for axes and legends
library(skimr)
library(funModeling) 
library(Hmisc)
library(grid)
library(hrbrthemes)
library(tidyr)
library(viridis)
library(ggthemes)
```

```{r message=FALSE, warning=FALSE}
## Loading the training dataset

load("~/GitHub/ff-beta-release-matching/poc/EDA/data_milestone2_df_train_validate_20191021.RData")
```

```{r message=FALSE, warning=FALSE}
## View train dataframe 

kable(head(df_train_f)) %>%
kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = F) %>%
scroll_box(width = "100%")
```

## Step 1 : Data Inspection

To get introduced to our dataset, et's have a look on the basic information of the dataset.

```{r echo=FALSE}
kable(introduce(df_train_f)) %>%
kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = F) %>%
scroll_box(width = "100%")
```

```{r echo=FALSE, fig.height=10, fig.width=10}
plot_intro(df_train_f, ggtheme = theme_minimal())
```

### Observations

* Most of the dataset is composed of continuous variables
* No NAs values (were handled in preprocessing)

### Structure

Let's use `glimpse` function to display a vertical preview of the dataset. So we can easily preview data type and sample data.

```{r}
glimpse(df_train_f)
```

If we want to get some metrics about data types, zeros, infinite numbers, and missing values, we can use the `df_status` function.

```{r}
kable(df_status(df_train_f, FALSE)) %>%
kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = F) %>%
scroll_box(width = "100%")
```

* `q_zeros`: quantity of zeros (`p_zeros`: in percent)
* `q_inf`: quantity of infinite values (`p_inf`: in percent)
* `q_na`: quantity of NA (`p_na`: in percent)
* `type`: factor, ordered-factor, numeric, integer or character
* `unique`: quantity of unique values

#### Observations

> Are all the variables in the correct data type?

None. It seems that this has already been dealt with in preprocessing. 

> Any variables with lots of zeros? 

Yes. Variables with lots of zeros may not be useful for modeling and, in some cases, they may dramatically bias the model. For example, the `content_crashes` is 100% equal to zero.  

> Any variables with lots of NAs? 

None. Good news.

> Any high cardinality variable?

Factor/categorical variables with a high number of different values (~30) tend to do overfitting if the categories have low cardinality. Besides `client_id`, it doesn't seem like there are other high cardinality variables.

## Step 2 : Beta vs Release

```{r, fig.width = 7.5}
df_release <- df_train_f[which(df_train_f$label == 'release'), ]
df_beta <- df_train_f[which(df_train_f$label == 'beta'), ]

f <- freq(df_train_f$label)
```


```{r}
summary(df_release)
```


```{r}
summary(df_beta)
```

## Step 3 - Analyzing Discrete Variables

```{r, fig.width = 15, fig.height = 15}
## Frequency distribution release dataframe
plot_bar(df_release, ggtheme = theme_minimal(base_size = 15))
```

```{r, fig.width = 15, fig.height = 15}
## Frequency distribution beta dataframe
plot_bar(df_beta, ggtheme = theme_minimal(base_size = 15))
```

## Step 4 - Analyzing Continuos Variables

```{r, fig.width = 15, fig.height = 15}
## View histogram of release dataset
plot_histogram(df_release, ggtheme = theme_minimal(base_size = 15))
```

```{r, fig.width = 15, fig.height = 15}
## View histogram of beta dataset
plot_histogram(df_beta, ggtheme = theme_minimal(base_size = 15))
```


```{r message=FALSE, warning=FALSE}
ggplot(data=df_train_f, aes(x=daily_max_tabs, group=label, fill=label)) +
    geom_density(adjust=1.5, alpha=0.6, main="Daily Max Tabs") + xlim(0, 20) +
    scale_fill_viridis(discrete=TRUE) +
    scale_color_viridis(discrete=TRUE) +
    theme_ipsum()
```

```{r message=FALSE, warning=FALSE}
ggplot(data=df_train_f, aes(x=startup_ms, group=label, fill=label)) +
    geom_density(adjust=1.5, alpha=0.6, main="Startup (ms)") + xlim(0, 5) +
    scale_fill_viridis(discrete=TRUE) +
    scale_color_viridis(discrete=TRUE) +
    theme_ipsum()
```

```{r message=FALSE, warning=FALSE}
ggplot(data=df_train_f, aes(x=num_active_days, group=label, fill=label)) +
    geom_histogram(stat = "bin", position = "identity", alpha=0.5, main="Num Active Days") +
    scale_fill_viridis(discrete=TRUE) +
    scale_color_viridis(discrete=TRUE) +
    theme_ipsum()
```


```{r message=FALSE, warning=FALSE}
ggplot(data=df_train_f, aes(x=active_hours, group=label, fill=label)) +
    geom_density(adjust=1.5, alpha=0.6, main="Active Hours") +
    scale_fill_viridis(discrete=TRUE) +
    scale_color_viridis(discrete=TRUE) +
    theme_ipsum()
```

```{r message=FALSE, warning=FALSE}
ggplot(data=df_train_f, aes(x=num_pages, group=label, fill=label)) +
    geom_density(adjust=1.5, alpha=0.6, main="Num Pages") + xlim(0, 50000) +
    scale_fill_viridis(discrete=TRUE) +
    scale_color_viridis(discrete=TRUE) +
    theme_ipsum()
```

```{r message=FALSE, warning=FALSE}
ggplot(data=df_train_f, aes(x=daily_num_sessions_started, group=label, fill=label)) +
    geom_density(adjust=1.5, alpha=0.6, main="Daily Num Sessions Started") + xlim(0, 20) +
    scale_fill_viridis(discrete=TRUE) +
    scale_color_viridis(discrete=TRUE) +
    theme_ipsum()
```

```{r message=FALSE, warning=FALSE}
ggplot(data=df_train_f, aes(x=TIME_TO_DOM_INTERACTIVE_MS, group=label, fill=label)) +
    geom_density(adjust=1.5, alpha=0.6, main="Time to DOM Interactive (ms)") +
    scale_fill_viridis(discrete=TRUE) +
    scale_color_viridis(discrete=TRUE) +
    theme_ipsum()
```

```{r message=FALSE, warning=FALSE}
ggplot(data=df_train_f, aes(x=FX_PAGE_LOAD_MS_2_PARENT, group=label, fill=label)) +
    geom_density(adjust=1.5, alpha=0.6, main="FX Page Load (ms)") +
    scale_fill_viridis(discrete=TRUE) +
    scale_color_viridis(discrete=TRUE) +
    theme_ipsum()
```

```{r message=FALSE, warning=FALSE}
ggplot(data=df_train_f, aes(x=TIME_TO_DOM_CONTENT_LOADED_END_MS, group=label, fill=label)) +
    geom_density(adjust=1.5, alpha=0.6, main="Time to DOM Content Loaded End (ms)") +
    scale_fill_viridis(discrete=TRUE) +
    scale_color_viridis(discrete=TRUE) +
    theme_ipsum()
```

```{r message=FALSE, warning=FALSE}
ggplot(data=df_train_f, aes(x=TIME_TO_LOAD_EVENT_END_MS, group=label, fill=label)) +
    geom_density(adjust=1.5, alpha=0.6, main="Time to Load Event End (ms)") +
    scale_fill_viridis(discrete=TRUE) +
    scale_color_viridis(discrete=TRUE) +
    theme_ipsum()
```

```{r message=FALSE, warning=FALSE}
ggplot(data=df_train_f, aes(x=TIME_TO_NON_BLANK_PAINT_MS, group=label, fill=label)) +
    geom_density(adjust=1.5, alpha=0.6, main="Time to Non Blank Paint (ms)") +
    scale_fill_viridis(discrete=TRUE) +
    scale_color_viridis(discrete=TRUE) +
    theme_ipsum()
```

```{r message=FALSE, warning=FALSE}
ggplot(data=df_train_f, aes(x=TIME_TO_DOM_COMPLETE_MS, group=label, fill=label)) +
    geom_density(adjust=1.5, alpha=0.6, main="Time to DOM Complete (ms)") +
    scale_fill_viridis(discrete=TRUE) +
    scale_color_viridis(discrete=TRUE) +
    theme_ipsum()
```

### Observations